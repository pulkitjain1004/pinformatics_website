<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width; initial-scale=1.0">
	<title>Assignment 4 Alternate</title>
    <link href="mobile.css" rel="stylesheet" type="text/css" media="screen and (max-width:751px)"/>
    <link href="nav.css" rel="stylesheet" type="text/css" media="screen and (min-width:750px)"/>
    <link href="print.css" rel="stylesheet" type="text/css" media="print"/>            
	<style type="text/css">

    </style>	
</head>

<body>
	<header>
		<h1> <center> Assign #4 [Alternate]: Reshaping & Combining Tables </h1>
		<h2> <center> Recommended Work Time: Two Weeks </center> </h2>
	</header>
	<div id="wrapper">	
		<nav id="side">
	    	<ul>
		        <li><a href="index.html"> Home</a></li>
		        <li><a href="A1.html"> Assignment 1 </a></li>
		        <li><a href="A2.html"> Assignment 2 </a>
		        	<ul>
		        		<li><a href="L2.html"> Lab 2 </a></li>
		        		<li><a href="L2S.html"> Lab 2 Supp. </a></li>
		        		<li><a href="A2.html"> Assignment 2 </a></li>
		        	</ul>
		        </li>
		        <li><a href="A3.html"> Assignment 3 </a>
		        	<ul>
		        		<li><a href="L3.html"> Lab 3 </a></li>
		        		<li><a href="A3.html"> Assignment 3 </a></li>
		        	</ul>
		        </li>
		        <li><a href="A4.html"> Assignment 4</a>
		        	<ul>
		        		<li><a href="data/lab4.zip" dwonload> Lab4 </a></li>
		        		<li><a href="A4.html"> Assignment 4 </a></li>
		        		<li><a href="A4A.html"> Assignment 4 Alt. </a></li>
		        		<li><a href="A4S.html"> Assignment 4 Supp. </a></li>
		        	</ul>
		        </li>
		        <li><a href="A5.html"> Assignment 5</a></li>       
		        <li><a href="Final.html"> Final Project</a></li>
		    </ul>
	    </nav>
	    <div id= "top">
			<h3>Table of Contents</h3>
			<ol>
				<li><a href="#OVV">Overview</a></li>
				<li><a href="#RRA">Required Readings</a></li>
				<li><a href="#GAG">Grading</a></li>
				<li><a href="#AS4">Assignment 4</a></li>
				<li><a href="#ANA">Analysis</a></li>
			</ol>
		</div>
		<article>
			<b>IMPORTANT NOTE: </b>
			<ul>
				<li>This document has supplemental information INSERTED (in different font) into the full assignment 4 on the website. Use this or the other. NOT BOTH.</li>
				<li>This is optional submission for only those that have an accumulative grade less than 90% in class. The assignment is designed so that you can do this, and then do one more thing to get the full 12 points and complete the full assignment.</li>
				<li>The only difference is that you will be working with the TINY datasets so that you can see the full dataset as you build your process.  Also, I have left out the problem data rows.  You should be using proc print data=fn(obs=100) in between data steps and proc steps to see what your code does to the tables in each step.</li>
				<li>In addition, this word document has some more hints. </li>
				<li>All submissions are IDENTICAL to the original assignment. I made sure that the questions are still valid in these tiny data.  Of course, the answers will be different and less meaningful.</li>
				<li>You must submit sas code that answers your questions (i.e. if you manually do this without using sas code, you will not get credit)</li>
				<li>A full submission using this tiny dataset is 11 points.  1 additional point (for full credit) can be obtained, if you take the code you wrote, and make it run on the big dataset.  See below for hints on how to do this.</li>
			</ul>
		</article>
		<article>
			<a name = "OVV"></a>
			<h2><u>Overview</u></h2>
			<p>
				<b>Submission.</b>  Submit on blackboard by 11:59pm the day before the class they are due.
				<ol> 
					<li>Lab (2 points. GRADED)<ul>
						<li>Fill in the excel sheet and submit</li></ul></li>
					<li>Midpoint email (1 point. SEPARATE from Lab)<ul>
						<li>Describe in one sentence, what each of the tables are (there is a total of 8).</li>
						<li>What is the unit (row) of each table? </li>
						<li>For each table that does not have the required unit of</li> analysis as “county year”, explain how you will convert the given table into the required “county year” table. If not applicable write NA.</li>
						<li>When linking up all the tables to have all the variables in one table, <ul>
							<li>Which tables link up as 1-to-1 matching ? What are the matching variables?</li>
							<li>Which tables link up as 1-to-N matching ? What are the matching variables?</li></ul></li></ul></li>
					<li>Assignment (9 points)<ul>
						<li>Commented code (lnameN.sas; where N indicates the assignment number and lname is your last name)</li>
						<li>Output from your code (lnameN.log & (lnameN.lst or lnameN.html)) </li>
						<li>Answers to questions: Readme.txt </li></ul></li>
				</ol>
				<b>Late Assignments.</b>   Each student will be allowed one late assignment, due 7 days from the due date.  NO other late assignments or make up will be accepted.<br><br>
				<b>Plagiarism:</b> If you consult any outside sources when doing your work, you are expect to further document these sources.  Give credit where credit is due.  Plagiarism will not be tolerated. <br><br>
				All handed in homework should state at the top any assistance with debugging and programming, as well as citations of any program segments copied from a website.
			</p>
			<p>
				<a name = "RRA"></a>
				<h2><u>Required readings for this assignment</u></h2>
				<ol>
					<li><a href="http://www.ats.ucla.edu/stat/sas/modules/merge.htm" target="_blank">http://www.ats.ucla.edu/stat/sas/modules/merge.htm</a></li>
					<li><a href="http://www.ats.ucla.edu/stat/sas/modules/concat.htm" target="_blank">http://www.ats.ucla.edu/stat/sas/modules/concat.htm</a></li>
					<li><a href="http://www.ats.ucla.edu/stat/sas/modules/wtol_transpose.htm" target="_blank">http://www.ats.ucla.edu/stat/sas/modules/wtol_transpose.htm</a></li>
					<li><a href="http://www.ats.ucla.edu/stat/sas/modules/widetolong_data.htm" target="_blank">http://www.ats.ucla.edu/stat/sas/modules/widetolong_data.htm</a></li>
					<li><a href="http://www.ats.ucla.edu/stat/sas/modules/ltow_transpose.htm" target="_blank">http://www.ats.ucla.edu/stat/sas/modules/ltow_transpose.htm</a></li>
					<li><a href="http://www.ats.ucla.edu/stat/sas/modules/longtowide_data.htm" target="_blank">http://www.ats.ucla.edu/stat/sas/modules/longtowide_data.htm</a></li>
					<li><a href="http://proquest.safaribooksonline.com.lib-ezproxy.tamu.edu:2048/9781612903439?uicode=tamucollst" target="_blank">The little SAS book</a>: Chapters 1 & 6</li>
				</ol>
			</p>
			<p>
				<a name = "GAG"></a>
				<h2><u>Guideline for assignment grading (Total of 12)</u></h2>
				<ul>
					<li>Assignment (Total 8)<ul>
						<li>2: Submitted code that does not run.</li>
						<li>4: Mostly running but incorrect.</li>
						<li>6: Correct and meets requirements (i.e use of arrays and loops)</li>
						<li>8: Correct & Elegant. Comments.</li></ul></li>
					<li>Answers to questions on the assignment (Total 1)</li>
					<li>Midpoint Check email (Total 1)</li>
					<li>Lab (Total 2) – DON’T forget to submit this with this assignment if you have not made an early submission the week before.</li>
				</ul>
			</p>
			<p>
				<a name = "AS4"></a>
				<h2><u>Assignment 4: Reshaping and Combining Tables</u></h2>
				By the end of this assignment, you should be able to
				<ul>
					<li>Append multiple tables (e.g stack tables on top of each other to increase the number of rows) using set </li>
					<li>Link up multiple tables using a shared key (e.g align the rows using the shared key, and link multiple tables to increase the number of variables in the tables) using merge. </li>
					<li>Aggregate/Combine multiple rows into one row by group processing proc summary</li>
					<li>Reshape tables to flip rows & columns using proc transpose<ul>
						<li>Also transpose (flip rows & columns) by groups of rows</li></ul></li>
				</ul>

				<b>Setting Up:</b> Get data from BB into the appropriate folder: The links are provided only as a reference for documentation of the data. All data are provided on BB in the Assignments folder as a zipped file.  Look at the data using proc contents/proc print (use the label option) to understand what variables you have. Do NOT open these tables using point & click.  If you need more information, look at information on the webpages.
				<ol>
					<li>Texas Discharge data (www.dshs.state.tx.us/thcic/hospitals/Inpatientpudf.shtm).</li>
					<li>Texas Physician Supply data (http://www.dshs.state.tx.us/chs/hprc/PHYS-lnk.shtm)</li>
					<li>Texas Death data (http://soupfin.tdh.state.tx.us/deathdoc.htm)</li>
					<li>Texas Health Regions Look-up Table (http://www.dshs.state.tx.us/chs/brfss/pages/counties.shtm)</li>
				</ol>
				The only thing you have to do differently from the full assignment is to run sas code I provide here ONCE before you start working.  It will overwrite the large datasets with a tiny dataset ready for you to do the assignment.  Following are suggested sequence of action
				<ol>
					<li>AFTER getting the above files into your data folder</li>
					<li>Run the following code for ALL 8 datasets (this is example code for 1 dataset).  I suggest saving this program separately as “pre.sas”.  You do NOT have to submit this to me.  <br>
						data data.phy2010;<br>
						set data.phy2010;<br>
						where county in ('Brazos', 'Brewster', 'Austin', 'Childress');</li>
					<li>That is it.  You DO NOT have to rerun this again, unless you corrupt these files </li>
					<li>If you mistakenly overwrite them, unzip the original data and repeat steps 1 to 3.</li>
				</ol>
				<b>Combine all the tables: </b>
				<ul>
					<li>The initial unit of analysis for this assignment is “county year”. Thus, you will have to have 1 observation per “county year” in each table unless it is a county look up table.  The county look up table has 1 observation per county which should link to all years.
					<li>Which tables need to be changed to have 1 row per “county year”? How? Change these tables to the right unit of analysis.  Following are things to consider.(GET NEW DEATH DATA for more than 2010)<ul>
						<li>If you have multiple tables of the same kind of data (one table per year), append them as appropriate. Hint: rename variables as needed. Convert variable type to be the same if needed. Add year variable as needed during the appending process using in option.<ul>
								<li>You should combine the multiple inpatient datasets into one dataset. </li>
								<li>As you combine the data, don’t forget to add a new variable “year” indicating which year the row represents. Use the in option.</li>
								<li>I recommend creating a new variable for annual discharge, so that you can look at one variable when answering questions 2 & 3 below.</li>
								<li>Same applies to the physician supply datasets
								<li>This uses set</li></ul></li>
						<li>If the table is wide (years are going across columns), than convert to long (so that the years are going down rows)<ul>
							<li>The death dataset needs to be transposed</li>
							<li>This uses proc transpose</li></ul></li>
						<li>If you have multiple rows per “county year”, than aggregate the rows into one row using the correct statistics (sum, mean etc)</li></ul></li>
					<li>Now link all the tables together to have all the variables in one table (counts of discharge, physician supply, number of deaths, border county, etc).<ul>
						<li>What are the variables you must line up (matching vars), to get the tables to link up properly? (Hint: 1-to-1 matching and 1-to-N matching have to be done separately)<ul>
								<li>The inpatient data needs the rows consolidated to one row per “county year”</li>
								<li>This uses proc summary</li></ul></li>
						<li><b><u>There are issues with the data that make some rows not line up properly.</u></b>  Identify which rows these are and figure out how to get them to line up.  Whenever you are merging tables this way, make sure to check which rows are lining up in all tables, and which rows are not using the in option.  For the rows not lining up, check if these are expected to not line up (really missing in some tables, or not lining up due to a problems in the data).  Hint: check the county names in the tables (look up compress & lowcase functions).   There are 254 counties in TX.  The county lookup tables has the correct names.  One way to check county names in each table is to link up with the lookup table and look at rows that are not linking up properly since all should link up to one of the 254 rows in the lookup table. Once you have identify what needs to be fixed, you can use the if conditional statement to reassign to correct values.<ul>
							<li>Ignore this when using only the tiny datasets. But if you than come back to make your code work for the large datasets, this is what you have to “improve” your code on.</li></ul></li></ul></li>
					<li>[Read Question 7 below first] Now we will change the unit of analysis to “PHR (Public Health Region) Year”. Aggregate “county year” data to have 1 row per “PHR Year”.  Think about what is the proper statistics (sum, mean, median, etc) for the variables you need (i.e. you don’t need to have all the vars, just what you need to answer the question 7 below) when aggregating.</li>
					<li>[Read Questions 8-9 below first] Now we will change the unit of analysis to “MSA (Metropolitan Statistical Area) Border”. <ul>
						<li>First, aggregate the “county year” data to 1 row per “MSA Border Year”.  You should remove all rows that do not have the MSA designation</li>
						<li>Second, reshape the table from long (years going down the rows) to wide (years going across columns) per “MSA Border”.  You should have exactly 31 rows (number of  MSAs).</li>
						<li>Third, using arrays, calculate the percent increase in patients discharged each year (i.e. 2011 & 2012).</li></ul></li>
					<li>If you have everything working fully with the tiny data, here are suggested steps for moving to the next step of making it work on the original large data.<ol>
						<li>Create a different subfolder (e.g. orig/) from data/ in your assign4/ workspace</li>
						<li>Place the original large datasets in the new folder</li>
						<li>Point your libname to the new folder</li>
						<li>Now rerun your code. If you did everything correctly, the code should run with no problem.</li>
						<li>So the work for the last 1 point: although the code runs, you will see that you have more rows than you should have (254*3).  This means you have incorrect results.  This is due to some data errors in the original data that you have to identify and fix.  A strategy for this will be discussed on 3/3.  See if you can fix this, and answer the questions using the full data, for full credit rather than the tiny data.  If you get this far, you can submit the readme file for both or just the full data.  Congratulations, you have fully complete the assignment!</ol></li>
					</ul>

			</p>
		</article>
		<article id = "last">
			<a name = "ANA"></a>
			<p>
				<b>Readme file:</b> Answer the following questions in a text file called readme.txt<br><br>
				&lt County Year Analysis &gt
				<ol>
					<li>How many total observations do you have when the merge is complete? </li>
					<li>How many observations are missing patient data? </li>
					<li>How many counties in your dataset are missing patient data for AT LEAST 1 year? (notice, we want the number of counties, not the number of observations that are missing patient data) ?</li>
					<li>What is the average size (in terms of the population variable) of all observations (county/years) that have missing patient data? </li>
					<li>Which observations (which county/years) have more deaths than inpatient discharges? How many observations have more deaths than physicians ?</li>
					<li>How does the Ratio of DPC per 100,000 Population variable differ by border and non-border counties; that is, which has a higher average Ratio of DPC per 100,000 Population?</li>
				</ol>
				&lt PHR Year Analysis &gt
				<ol start = "7">
					<li>Compare the average number of physicians and the average number of patients across all PHRs for each year. Which PHR has the highest average physician to average patients ratio in each year? (Hint: you will need to calculate this ratio before running a command to compare across PHRs)</li>
				</ol>
				&lt MSA Border Analysis &gt
				<ol start = "8">
					<li>How many MSAs are in the border region?</li>
					<li>Which MSA had the largest increase in patient discharges in 2011? What about 2012? (Hint: one way to do this would be to sort your data before printing)</li>
				</ol>
		</article>
	</div>
</body>
</html>