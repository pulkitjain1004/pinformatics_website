<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width; initial-scale=1.0">
<title>PHPM 672 Home</title>

<!--     <link href="mobile.css" rel="stylesheet" type="text/css" media="screen and (max-width:751px)"/> -->
    <link href="large.css" rel="stylesheet" type="text/css" media="only screen and (min-width:1500px)"/>
    <link href="medium.css" rel="stylesheet" type="text/css" media="only screen and (max-width:1499px)"/>
    <link href="tablet.css" rel="stylesheet" type="text/css" media="only screen and (max-width:1167px)"/>
    <link href="mobile.css" rel="stylesheet" type="text/css" media="only screen and (max-width:650px)"/>
    <link href="print.css" rel="stylesheet" type="text/css" media="print"/>


<style type="text/css">
</style>
</head>

<body>    
	<div id="wrapper">
		<a name="ontop"> </a>
		<div class="headertop" id="headertop1">
		</div>
		<div class="headertop" id="headertop2">
			<p>
				<h1>PHPM 672 Data Science in Public Health (PhD) &</h1>
				<h1>PHPM 677 Data Science for Health Services Research (MPH)</h1>
			</p>
		</div>

		<div class="header" id="header1">
		</div>
		<div class="header" id="header2">
			<p>
				<h2>Spring 2015</h2>
				<h2>Assignment 4</h2>
				<h3>Reshaping & Combining Tables</h3>
			</p>
		</div>
		<div class="header" id="header3">
			<h1>PHPM 677</h1>
			<h1>PHPM 672</h1>
		</div>
		<div class="header" id="header4">
			<h1>Data Science in Public Health (PhD)</h1>
			<h1>Data Science for Health Services Research (MPH)</h1>
		</div>
		<div class="header" id="header5">
		</div>
		<div class="header" id="header6">
		</div>




		<div class="top" id="top1">
		</div>
		<div class="top" id="top2">
			<ul>
		        <li><a href="index.html"> Home</a></li>
		        <li><a href="syllabus.html"> Syllabus</a></li>
		        <li><a href="A1.html"> Assignment 1 </a></li>
		        <li><a href="A2.html"> Assignment 2 </a>
		        	<ul>
		        		<li><a href="L2.html"> Lab 2 </a></li>
		        		<li><a href="L2S.html"> Lab 2 Supp. </a></li>
		        		<li><a href="A2.html"> Assignment 2 </a></li>
		        	</ul>
		        </li>
		        <li><a href="A3.html"> Assignment 3 </a>
		        	<ul>
		        		<li><a href="L3.html"> Lab 3 </a></li>
		        		<li><a href="A3.html"> Assignment 3 </a></li>
		        	</ul>
		        </li>
		        <li><a href="A4.html"> Assignment 4</a>
		        	<ul>
		        		<li><a href="data/lab4.zip" dwonload> Lab4 </a></li>
		        		<li><a href="A4.html"> Assignment 4 </a></li>
		        		<li><a href="A4A.html"> Assignment 4 Alt. </a></li>
		        		<li><a href="A4S.html"> Assignment 4 Supp. </a></li>
		        	</ul>
		        </li>
		        <li><a href="A5.html"> Assignment 5</a></li>   
		        <li><a href="Final.html"> Final Project</a></li>
		    </ul>
		</div>
		<div class="top" id="toph">
		<div class="top" id="toph">
	    	<ul>
    			<li><a href="#">M<br>E<br>N<br>U</a></li>
				<ul>
			        <li><a href="index.html"> Home</a></li>
			        <li><a href="syllabus.html"> Syllabus</a></li>
			        <li><a href="A1.html"> Assignment 1 </a></li>
			        <li><a href="A2.html"> Assignment 2 </a>
			        	<ul>
			        		<li><a href="L2.html"> Lab 2 </a></li>
			        		<li><a href="L2S.html"> Lab 2 Supp. </a></li>
			        		<li><a href="A2.html"> Assignment 2 </a></li>
			        	</ul>
			        </li>
			        <li><a href="A3.html"> Assignment 3 </a>
			        	<ul>
			        		<li><a href="L3.html"> Lab 3 </a></li>
			        		<li><a href="A3.html"> Assignment 3 </a></li>
			        	</ul>
			        </li>
			        <li><a href="A4.html"> Assignment 4</a>
			        	<ul>
			        		<li><a href="data/lab4.zip" dwonload> Lab4 </a></li>
			        		<li><a href="A4.html"> Assignment 4 </a></li>
			        		<li><a href="A4A.html"> Assignment 4 Alt. </a></li>
			        		<li><a href="A4S.html"> Assignment 4 Supp. </a></li>
			        	</ul>
			        </li>
			        <li><a href="A5.html"> Assignment 5</a></li>   
			        <li><a href="Final.html"> Final Project</a></li>
			    </ul>
			</ul>
		</div>
		</div>
		<div class="top" id="top3">
		</div>
		<div class="top" id="topside">
		</div>


		<div class="body" id="body1">
			<h2>Overview</h2>
			<p id="phead"><u>Submission</u></p>
			<p id="pbody">
				Submit on blackboard by 11:59pm the day before the class they are due.    
		        <ol> 
					<li>Lab (2 points. GRADED)<ul>
						<li>Fill in the excel sheet and submit</li></ul></li>
					<li>Midpoint email (1 point. SEPARATE from Lab)<ul>
						<li>Describe in one sentence, what each of the tables are (there is a total of 8).</li>
						<li>What is the unit (row) of each table? </li>
						<li>For each table that does not have the required unit of</li> analysis as “county year”, explain how you will convert the given table into the required “county year” table. If not applicable write NA.</li>
						<li>When linking up all the tables to have all the variables in one table, <ul>
							<li>Which tables link up as 1-to-1 matching ? What are the matching variables?</li>
							<li>Which tables link up as 1-to-N matching ? What are the matching variables?</li></ul></li></ul></li>
					<li>Assignment (9 points)<ul>
						<li>Commented code (lnameN.sas; where N indicates the assignment number and lname is your last name)</li>
						<li>Output from your code (lnameN.log & (lnameN.lst or lnameN.html)) </li>
						<li>Answers to questions: Readme.txt </li></ul></li>
				</ol>
			</p>
			<p id="phead"> <u>Late Assignments</u> </p>
			<p id="pbody">
				Each student will be allowed one late assignment, due 7 days from the due date.  NO other late assignments or make up will be accepted.
			</p>
			<p id="phead"> <u>Plagiarism</u> </p>
			<p id="pbody">
				If you consult any outside sources when doing your work, you are expect to further document these sources.  Give credit where credit is due.  Plagiarism will not be tolerated.<br><br>
				<b><u>All handed in homework should state at the top any assistance with debugging and programming, as well as citations of any program segments copied from a website. </p></b></u>
			</p>
		</div>

		<div class="body" id="body2">
			<h2>Reading</h2>
			<p id="phead"> <u>Required Readings for this assignment</u> </p>
			<p id="pbody">				
		        <ol>
					<li><a href="http://www.ats.ucla.edu/stat/sas/modules/merge.htm" target="_blank">http://www.ats.ucla.edu/stat/sas/modules/merge.htm</a></li>
					<li><a href="http://www.ats.ucla.edu/stat/sas/modules/concat.htm" target="_blank">http://www.ats.ucla.edu/stat/sas/modules/concat.htm</a></li>
					<li><a href="http://www.ats.ucla.edu/stat/sas/modules/wtol_transpose.htm" target="_blank">http://www.ats.ucla.edu/stat/sas/modules/wtol_transpose.htm</a></li>
					<li><a href="http://www.ats.ucla.edu/stat/sas/modules/widetolong_data.htm" target="_blank">http://www.ats.ucla.edu/stat/sas/modules/widetolong_data.htm</a></li>
					<li><a href="http://www.ats.ucla.edu/stat/sas/modules/ltow_transpose.htm" target="_blank">http://www.ats.ucla.edu/stat/sas/modules/ltow_transpose.htm</a></li>
					<li><a href="http://www.ats.ucla.edu/stat/sas/modules/longtowide_data.htm" target="_blank">http://www.ats.ucla.edu/stat/sas/modules/longtowide_data.htm</a></li>
					<li><a href="http://proquest.safaribooksonline.com.lib-ezproxy.tamu.edu:2048/9781612903439?uicode=tamucollst" target="_blank">The little SAS book</a>: Chapters 1 & 6</li>
				</ol>
			</P>
		</div>

		<div class="body" id="body3">
			<h2>Grading</h2>
			<p id="phead"> <u>Guideline for assignment grading (Total of 12)</u> </p>
			<p id="pbody">				
				<ul>
					<li>Assignment (Total 8)<ul>
						<li>2: Submitted code that does not run.</li>
						<li>4: Mostly running but incorrect.</li>
						<li>6: Correct and meets requirements (i.e use of arrays and loops)</li>
						<li>8: Correct & Elegant. Comments.</li></ul></li>
					<li>Answers to questions on the assignment (Total 1)</li>
					<li>Midpoint Check email (Total 1)</li>
					<li>Lab (Total 2) – DON’T forget to submit this with this assignment if you have not made an early submission the week before.</li>
				</ul>
			</P>
		</div>

		<div class="body" id="body4">
			<h2>Assignment 4</h2>
			<p id="phead"> <u>Assignment 4: Reshaping & Combining Tables</u> </p>
			<p id="pbody">				
				By the end of this assignment, you should be able to
				<ul>
					<li>Append multiple tables (e.g stack tables on top of each other to increase the number of rows) using set </li>
					<li>Link up multiple tables using a shared key (e.g align the rows using the shared key, and link multiple tables to increase the number of variables in the tables) using merge. </li>
					<li>Aggregate/Combine multiple rows into one row by group processing proc summary</li>
					<li>Reshape tables to flip rows & columns using proc transpose<ul>
						<li>Also transpose (flip rows & columns) by groups of rows</li></ul></li>
				</ul>
			</P>
			<p id="phead"> <u>Setting Up</u> </p>
			<p id="pbody">				
				Get data from BB into the appropriate folder: The links are provided only as a reference for documentation of the data. All data are provided on BB in the Assignments folder as a zipped file.  Look at the data using proc contents/proc print (use the label option) to understand what variables you have. Do NOT open these tables using point & click.  If you need more information, look at information on the webpages.
				<ol>
					<li>Texas Discharge data (<a href="http://www.dshs.state.tx.us/thcic/hospitals/Inpatientpudf.shtm" target="_blank">www.dshs.state.tx.us/thcic/hospitals/Inpatientpudf.shtm</a>)</li>
					<li>Texas Physician Supply data (<a href="http://www.dshs.state.tx.us/chs/hprc/PHYS-lnk.shtm" target="_blank">http://www.dshs.state.tx.us/chs/hprc/PHYS-lnk.shtm)</a></li>
					<li>Texas Death data (<a href="http://soupfin.tdh.state.tx.us/deathdoc.htm" target="_blank">http://soupfin.tdh.state.tx.us/deathdoc.htm</a>)</li>
					<li>Texas Health Regions Look-up Table (<a href="http://www.dshs.state.tx.us/chs/brfss/pages/counties.shtm" target="_blank">http://www.dshs.state.tx.us/chs/brfss/pages/counties.shtm</a>)</li>
				</ol>
			</P>
			<p id="phead"> <u>Combine all the tables</u> </p>
			<p id="pbody">				
				<ul>
					<li>The initial unit of analysis for this assignment is “county year”. Thus, you will have to have 1 observation per “county year” in each table unless it is a county look up table.  The county look up table has 1 observation per county which should link to all years.
					<li>Which tables need to be changed to have 1 row per “county year”? How? Change these tables to the right unit of analysis.  Following are things to consider.<ul>
						<li>If you have multiple tables of the same kind of data (one table per year), append them as appropriate. Hint: rename variables as needed. Convert variable type to be the same if needed. Add year variable as needed during the appending process using in option.</li>
						<li>If the table is wide (years are going across columns), than convert to long (so that the years are going down rows)</li>
						<li>If you have multiple rows per “county year”, than aggregate the rows into one row using the correct statistics (sum, mean etc)</li></ul></li>
					<li>Now link all the tables together to have all the variables in one table (counts of discharge, physician supply, number of deaths, border county, etc).<ul>
						<li>What are the variables you must line up (matching vars), to get the tables to link up properly? (Hint: 1-to-1 matching and 1-to-N matching have to be done separately)</li>
						<li><b><u>There are issues with the data that make some rows not line up properly.</u></b>  Identify which rows these are and figure out how to get them to line up.  Whenever you are merging tables this way, make sure to check which rows are lining up in all tables, and which rows are not using the in option.  For the rows not lining up, check if these are expected to not line up (really missing in some tables, or not lining up due to a problems in the data).  Hint: check the county names in the tables (look up compress & lowcase functions).   There are 254 counties in TX.  The county lookup tables has the correct names.  One way to check county names in each table is to link up with the lookup table and look at rows that are not linking up properly since all should link up to one of the 254 rows in the lookup table. Once you have identify what needs to be fixed, you can use the if conditional statement to reassign to correct values.</li></ul></li>
					<li>[Read Question 7 below first] Now we will change the unit of analysis to “PHR (Public Health Region) Year”. Aggregate “county year” data to have 1 row per “PHR Year”.  Think about what is the proper statistics (sum, mean, median, etc) for the variables you need (i.e. you don’t need to have all the vars, just what you need to answer the question 7 below) when aggregating.</li>
					<li>[Read Questions 8-9 below first] Now we will change the unit of analysis to “MSA (Metropolitan Statistical Area) Border”. <ul>
						<li>First, aggregate the “county year” data to 1 row per “MSA Border Year”.  You should remove all rows that do not have the MSA designation</li>
						<li>Second, reshape the table from long (years going down the rows) to wide (years going across columns) per “MSA Border”.  You should have exactly 31 rows (number of  MSAs).</li>
						<li>Third, using arrays, calculate the percent increase in patients discharged each year (i.e. 2011 & 2012).</li></ul></li>
					</ul>
			</P>
		</div>

		<div class="body" id="body5">
			<h2>Questions</h2>
			<p id="phead"> <u>Readme file</u> </p>
			<p id="pbody">
				Answer the following questions in a text file called readme.txt<br><br>
				&lt County Year Analysis &gt
				<ol>
					<li>How many total observations do you have when the merge is complete? </li>
					<li>How many observations are missing patient data? </li>
					<li>How many counties in your dataset are missing patient data for AT LEAST 1 year? (notice, we want the number of counties, not the number of observations that are missing patient data) ?</li>
					<li>What is the average size (in terms of the population variable) of all observations (county/years) that have missing patient data? </li>
					<li>Which observations (which county/years) have more deaths than inpatient discharges? How many observations have more deaths than physicians ?</li>
					<li>How does the Ratio of DPC per 100,000 Population variable differ by border and non-border counties; that is, which has a higher average Ratio of DPC per 100,000 Population?</li>
				</ol>
			</p>
			<p id="pbody">
				&lt PHR Year Analysis &gt
				<ol start = "7">
					<li>Compare the average number of physicians and the average number of patients across all PHRs for each year. Which PHR has the highest average physician to average patients ratio in each year? (Hint: you will need to calculate this ratio before running a command to compare across PHRs)</li>
				</ol>
			</p>
			<p id="pbody">
				&lt MSA Border Analysis &gt
				<ol start = "8">
					<li>How many MSAs are in the border region?</li>
					<li>Which MSA had the largest increase in patient discharges in 2011? What about 2012? (Hint: one way to do this would be to sort your data before printing)</li>
				</ol>
			</p>
		</div>


		<div class="footer" id="footer1">
		</div>
		<div class="footer" id="footer2">
			<p>
				PHPM Webpage <br>
				Department of Public Health
			</p>
		</div>
		<div class="footer" id="footer3">
		</div>
		<div class="footer" id="footer4">
		</div>
		<div class="footer" id="footer5">
		</div>
		<div class="footer" id="footer6">
			<p>
				Designed by <br>
				DaeYoung Yoon
			</p>
		</div>
	</div>

	<nav id="side">
			<ul>
				<li><a href="#body1">Overview</a></li>
				<li><a href="#body2">Reading</a></li>
				<li><a href="#body3">Grading</a></li>
				<li><a href="#body4">Assignment</a></li>
				<li><a href="#body5">Questions</a></li>

				<li><a href="#wrapper">Top</a></li>
			</ul>
    </nav>
    <nav id="side_mobile">
    	<ul>
    		<li><a href="#">N<br>A<br>V</a></li>
			<ul>
				<li><a href="#body1">Overview</a></li>
				<li><a href="#body2">Reading</a></li>
				<li><a href="#body3">Grading</a></li>
				<li><a href="#body4">Assignment</a></li>
				<li><a href="#body5">Questions</a></li>

				<li><a href="#wrapper">Top</a></li>
			</ul>
		</ul>
    </nav>
</body>
</html>
